# Quoth Dashboard Audit â€” 2026-02-03

## Database Overview

| Table | Rows | Notes |
|-------|------|-------|
| documents | 96 | 4 projects |
| document_embeddings | 836 | All 96 docs have chunks |
| document_history | 36 | Version tracking |
| document_proposals | 0 | No proposals yet |
| projects | 4 | 1 orphan (no members) |
| project_members | 3 | 3 users, 1 project each |
| profiles | 3 | |
| quoth_activity | 218 | 175 searches, 38 reads |
| coverage_snapshot | 10 | All for attorneyshare project |
| project_api_keys | 1 | |
| project_invitations | 0 | |

## Projects

| Slug | Docs | Members | Status |
|------|------|---------|--------|
| attorneyshare-knowledge-base | 64 | 1 (admin) | Active â€” AgustÃ­n's project |
| lordmont-knowledge-base | 11 | 1 (admin) | Active |
| quothdocs-knowledge-base | 11 | 1 (admin) | Active |
| quoth-knowledge-base | 10 | 0 | **ORPHAN â€” no members!** |

## Issues Found

### ðŸ”´ Critical

#### 1. Coverage Card shows meaningless metrics
- **Root cause**: Coverage compares actual doc counts against hardcoded "Genesis expectations" (3 architecture, 4 patterns, 3 contracts = 10 total)
- **Effect**: Shows "100%" and weird ratios like "18/4" (18 docs but only 4 "expected")
- **Fix**: Replace Genesis expectations with actual metrics:
  - Coverage = docs with embeddings / total docs (currently 100% â€” all 96 docs have chunks)
  - Show real counts per category, not "documented/expected"

#### 2. 36 documents have NULL doc_type (56% of attorneyshare project)
- **Root cause**: Documents under `playwright-rules/` path don't get categorized
- **Effect**: Coverage breakdown misses 56% of documents, categories show wrong counts
- **Fix**: Either auto-categorize based on path, or add a "rules" / "other" category, or fix the indexing script to assign doc_type

#### 3. Search activity logs missing result_count
- **Data**: Most search events have `result_count: null` instead of actual count
- **Effect**: Miss rate calculation unreliable (33% miss rate may be inflated â€” searches with null result_count treated as 0)
- **Fix**: Ensure `logActivity()` in search tools passes `resultCount` correctly

### ðŸŸ¡ Medium

#### 4. Orphan project (quoth-knowledge-base)
- 10 documents, 0 members
- Likely from initial setup, never cleaned up
- **Fix**: Either assign a member or delete

#### 5. AgustÃ­n only sees 1 of 4 projects
- He's member of only `attorneyshare-knowledge-base` (64 docs)
- The other projects (lordmont, quothdocs) belong to different user accounts
- Dashboard shows 64 docs which is CORRECT for his project scope
- **Note**: Not a bug, but might want to consolidate projects

#### 6. Coverage snapshot stores stale calculated percentage
- `coverage_percentage` stored as `100.0` in DB
- But `getLatestCoverage()` reads `data.coverage_percentage` directly from snapshot
- If code changes how coverage is calculated, old snapshots show stale data
- **Fix**: Recalculate on read, or version the snapshots

#### 7. No data validation on coverage_snapshot.breakdown
- Stored JSON has `{"contract": {"expected": 3, "documented": 6}}` where documented > expected
- UI shows this as-is, creating confusing "6/3" display
- **Fix**: UI should cap display or show actual/total instead

### ðŸŸ¢ Opportunities

#### 8. Add embedding freshness metric
- All 96 docs have embeddings, but are they up-to-date?
- Compare `document.last_updated` vs `document_embeddings.metadata.indexedAt`
- Show "stale embeddings" count on dashboard

#### 9. Search quality improvement
- 33% miss rate is HIGH â€” 58 of 175 searches returned 0 results
- Top missed: "test failures anti-patterns flaky" (6x), "logout playwright test patterns" (4x)
- **Action**: Create docs for frequently missed queries, or improve search recall

#### 10. Multi-project dashboard
- Currently shows stats for first project only
- Add project selector or aggregate view

#### 11. Activity logging improvements
- `drift_detected`, `relevance_score`, `tool_name`, `file_path` all null in activity logs
- These fields exist but aren't being populated
- **Fix**: Update `logActivity()` calls to include available metadata

#### 12. Proposals feature unused
- 0 proposals in DB
- Feature exists in UI but may need promotion/integration
- Consider auto-generating proposals from drift detection

#### 13. API performance
- Dashboard page makes 3 parallel queries (good)
- ActivityCard uses SWR with dedup (good)
- But CoverageCard does a full scan on "Scan" button â€” could cache more aggressively

## Recommended Priority

1. **Fix doc_type categorization** for NULL docs â†’ biggest data quality issue
2. **Rewrite Coverage Card** to show real metrics
3. **Fix search result_count logging** for accurate miss rate
4. **Address top missed search queries** (content gaps)
5. **Clean up orphan project**
